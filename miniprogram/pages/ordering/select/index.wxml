<!--pages/ordering/select/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ï¼šä¼šè¯ä¿¡æ¯ -->
  <view class="session-header" wx:if="{{session}}">
    <view class="session-info">
      <text class="session-title">{{session.title}}</text>
      <text class="session-deadline">æˆªæ­¢: {{formatTime(session.deadline)}}</text>
    </view>
  </view>

  <!-- å·²é€‰èœå“ -->
  <view class="selected-section" wx:if="{{selectedItems.length > 0}}">
    <view class="section-header">
      <text class="section-title">å·²é€‰èœå“</text>
      <text class="section-count">{{totalQuantity}} ä»½</text>
    </view>
    <view class="selected-list">
      <view class="selected-item" wx:for="{{selectedItems}}" wx:key="menuItemId">
        <image class="item-image" src="{{item.menu_item.image_url || defaultImage}}" mode="aspectFill" />
        <view class="item-info">
          <text class="item-name">{{item.menu_item.name}}</text>
          <text class="item-price">Â¥{{item.menu_item.price / 100}}</text>
        </view>
        <view class="item-actions">
          <view class="quantity-btn minus" bindtap="onDecrease" data-index="{{index}}">-</view>
          <text class="quantity">{{item.quantity}}</text>
          <view class="quantity-btn plus" bindtap="onIncrease" data-index="{{index}}">+</view>
        </view>
      </view>
    </view>
    <view class="selected-footer">
      <view class="total">
        <text class="total-label">å°è®¡</text>
        <text class="total-amount">Â¥{{totalAmount / 100}}</text>
      </view>
      <view class="submit-btn" bindtap="onSubmit">ç¡®è®¤ç‚¹é¤</view>
    </view>
  </view>

  <!-- ç©ºé€‰æ‹©çŠ¶æ€ -->
  <view class="empty-selection" wx:if="{{selectedItems.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ½ï¸</text>
    <text class="empty-text">è¿˜æ²¡æœ‰é€‰æ‹©èœå“</text>
    <text class="empty-hint">ä»ä¸‹æ–¹èœå•ä¸­é€‰æ‹©è¦ç‚¹çš„èœå“</text>
  </view>

  <!-- åˆ†ç±»Tab -->
  <scroll-view scroll-x class="category-scroll" wx:if="{{categories.length > 0}}">
    <view class="category-list">
      <view
        class="category-item {{activeCategoryId === item._id ? 'active' : ''}}"
        wx:for="{{categories}}"
        wx:key="_id"
        data-id="{{item._id}}"
        bindtap="onCategoryTap"
      >
        {{item.name}}
        <text class="category-count" wx:if="{{item.itemCount > 0}}">{{item.itemCount}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- èœå“åˆ—è¡¨ -->
  <view class="menu-list" wx:if="{{items.length > 0}}">
    <view class="menu-item" wx:for="{{items}}" wx:key="_id">
      <image class="item-image" src="{{item.image_url || defaultImage}}" mode="aspectFill" />
      <view class="item-info">
        <text class="item-name">{{item.name}}</text>
        <text class="item-price">Â¥{{item.price / 100}}</text>
        <text class="item-desc">{{item.description || 'æš‚æ— æè¿°'}}</text>
      </view>
      <view class="item-actions">
        <view class="add-btn {{getItemQuantity(item._id) > 0 ? 'has-added' : ''}}" bindtap="onAddItem" data-item="{{item}}">
          {{getItemQuantity(item._id) > 0 ? getItemQuantity(item._id) : '+'}}
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºåˆ†ç±»æç¤º -->
  <view class="empty-state" wx:if="{{categories.length > 0 && items.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ½ï¸</text>
    <text class="empty-text">è¯¥åˆ†ç±»ä¸‹æš‚æ— èœå“</text>
    <text class="empty-hint">è¯·å…ˆåœ¨"èœå•ç®¡ç†"ä¸­æ·»åŠ èœå“</text>
  </view>

  <!-- æ— åˆ†ç±»æç¤º -->
  <view class="empty-state" wx:if="{{categories.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-text">æš‚æ— èœå•</text>
    <text class="empty-hint">è¯·å…ˆåœ¨"èœå•ç®¡ç†"ä¸­æ·»åŠ åˆ†ç±»å’Œèœå“</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">åŠ è½½ä¸­...</view>
</view>
