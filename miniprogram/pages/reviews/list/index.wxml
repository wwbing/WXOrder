<!--pages/reviews/list/index.wxml-->
<view class="container">
  <!-- è¯„ä»·ç»Ÿè®¡ -->
  <view class="stats-card" wx:if="{{stats && stats.total_count > 0}}">
    <view class="avg-section">
      <text class="avg-score">{{stats.avg_rating}}</text>
      <text class="avg-unit">åˆ†</text>
    </view>
    <view class="rating-info">
      <view class="stars">
        <text class="star {{idx < stats.avg_rating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:for-index="idx" wx:key="*this">â˜…</text>
      </view>
      <text class="total-count">{{stats.total_count}} æ¡è¯„ä»·</text>
    </view>
  </view>

  <!-- çƒ­é—¨æ ‡ç­¾ -->
  <view class="tags-section" wx:if="{{stats && stats.popular_tags && stats.popular_tags.length > 0}}">
    <text class="tags-title">å¤§å®¶éƒ½åœ¨è¯´</text>
    <view class="tags-list">
      <text class="tag" wx:for="{{stats.popular_tags}}" wx:key="tag">{{item.tag}} ({{item.count}})</text>
    </view>
  </view>

  <!-- è¯„ä»·åˆ—è¡¨ -->
  <view class="reviews-list" wx:if="{{list.length > 0}}">
    <view class="review-item" wx:for="{{list}}" wx:key="_id">
      <view class="review-header">
        <image class="user-avatar" src="{{item.user_avatar || defaultAvatar}}" mode="aspectFill" />
        <view class="user-info">
          <text class="user-name">{{item.user_name}}</text>
          <view class="stars">
            <text class="star {{idx < item.rating ? 'active' : ''}}" wx:for="{{[1,2,3,4,5]}}" wx:for-index="idx" wx:key="*this">â˜…</text>
          </view>
        </view>
        <text class="review-time">{{formatTime(item.created_at)}}</text>
      </view>

      <view class="review-content" wx:if="{{item.content}}">
        {{item.content}}
      </view>

      <!-- è¯„ä»·å›¾ç‰‡ -->
      <view class="review-images" wx:if="{{item.images && item.images.length > 0}}">
        <image
          class="review-image"
          wx:for="{{item.images}}"
          wx:for-item="img"
          wx:key="*this"
          src="{{img}}"
          mode="aspectFill"
          catchtap="previewImage"
          data-urls="{{item.images}}"
          data-current="{{img}}"
        />
      </view>

      <!-- å£å‘³æ ‡ç­¾ -->
      <view class="review-tags" wx:if="{{item.taste_tags && item.taste_tags.length > 0}}">
        <text class="tag" wx:for="{{item.taste_tags}}" wx:key="*this">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{list.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-text">æš‚æ— è¯„ä»·</text>
    <text class="empty-hint">æˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„äººå§ï¼</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">åŠ è½½ä¸­...</view>

  <!-- å†™è¯„ä»·æŒ‰é’® -->
  <view class="write-review-bar" wx:if="{{menuItemId && !hasReviewed}}">
    <view class="write-btn" bindtap="goToWriteReview">å†™è¯„ä»·</view>
  </view>
</view>
